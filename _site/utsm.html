<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ke Tian">

<title>DSAN 5600 lab0 – Univariate TS Models(ARIMA/SARIMA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DSAN 5600 lab0</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./aboutme.qmd"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ds.html"> 
<span class="menu-text">Data Sources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dv.html"> 
<span class="menu-text">Data Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./eda.html"> 
<span class="menu-text">Exploratory Data Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./utsm.html" aria-current="page"> 
<span class="menu-text">Univariate TS Models (ARIMA/SARIMA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mtsm.html"> 
<span class="menu-text">Multivariate TS Models (ARIMAX/SARIMAX/VAR)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ftsm.html"> 
<span class="menu-text">Financial Time Series Models (ARCH/GARCH)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dp.html"> 
<span class="menu-text">Deep Learning for TS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./other.html"> 
<span class="menu-text">Other: Interrupted TS/ARFIMA/ Spectral Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusion.html"> 
<span class="menu-text">Conclusion</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#natural-gas-productionarima" id="toc-natural-gas-productionarima" class="nav-link" data-scroll-target="#natural-gas-productionarima"><span class="header-section-number">2</span> Natural Gas Production(ARIMA)</a>
  <ul class="collapse">
  <li><a href="#acf-and-pacf" id="toc-acf-and-pacf" class="nav-link" data-scroll-target="#acf-and-pacf"><span class="header-section-number">2.1</span> ACF and PACF</a>
  <ul class="collapse">
  <li><a href="#second-difference-acf-and-pacf" id="toc-second-difference-acf-and-pacf" class="nav-link" data-scroll-target="#second-difference-acf-and-pacf"><span class="header-section-number">2.1.1</span> Second difference ACF and PACF</a></li>
  <li><a href="#manual-arima" id="toc-manual-arima" class="nav-link" data-scroll-target="#manual-arima"><span class="header-section-number">2.1.2</span> Manual ARIMA</a></li>
  <li><a href="#equation" id="toc-equation" class="nav-link" data-scroll-target="#equation"><span class="header-section-number">2.1.3</span> Equation</a></li>
  <li><a href="#model-diagnotic" id="toc-model-diagnotic" class="nav-link" data-scroll-target="#model-diagnotic"><span class="header-section-number">2.1.4</span> Model Diagnotic</a></li>
  <li><a href="#auto.arima" id="toc-auto.arima" class="nav-link" data-scroll-target="#auto.arima"><span class="header-section-number">2.1.5</span> auto.arima</a></li>
  <li><a href="#forcast" id="toc-forcast" class="nav-link" data-scroll-target="#forcast"><span class="header-section-number">2.1.6</span> Forcast</a></li>
  <li><a href="#compare-arima-model-with-benchmark-methods" id="toc-compare-arima-model-with-benchmark-methods" class="nav-link" data-scroll-target="#compare-arima-model-with-benchmark-methods"><span class="header-section-number">2.1.7</span> Compare ARIMA model with Benchmark methods</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#natural-gas-price-arima" id="toc-natural-gas-price-arima" class="nav-link" data-scroll-target="#natural-gas-price-arima"><span class="header-section-number">3</span> Natural Gas Price (ARIMA)</a>
  <ul class="collapse">
  <li><a href="#acf-and-pacf-1" id="toc-acf-and-pacf-1" class="nav-link" data-scroll-target="#acf-and-pacf-1"><span class="header-section-number">3.1</span> ACF and PACF</a></li>
  <li><a href="#maunal-sarima" id="toc-maunal-sarima" class="nav-link" data-scroll-target="#maunal-sarima"><span class="header-section-number">3.2</span> Maunal SARIMA</a>
  <ul class="collapse">
  <li><a href="#aic-bic" id="toc-aic-bic" class="nav-link" data-scroll-target="#aic-bic"><span class="header-section-number">3.2.1</span> AIC &amp; BIC</a></li>
  <li><a href="#equation-model-diagnotic" id="toc-equation-model-diagnotic" class="nav-link" data-scroll-target="#equation-model-diagnotic"><span class="header-section-number">3.2.2</span> Equation &amp; Model Diagnotic</a></li>
  </ul></li>
  <li><a href="#auto.arima-1" id="toc-auto.arima-1" class="nav-link" data-scroll-target="#auto.arima-1"><span class="header-section-number">3.3</span> auto.arima</a>
  <ul class="collapse">
  <li><a href="#equation-model-diagnotic-1" id="toc-equation-model-diagnotic-1" class="nav-link" data-scroll-target="#equation-model-diagnotic-1"><span class="header-section-number">3.3.1</span> Equation &amp; Model Diagnotic</a></li>
  </ul></li>
  <li><a href="#forcast-of-manual-model" id="toc-forcast-of-manual-model" class="nav-link" data-scroll-target="#forcast-of-manual-model"><span class="header-section-number">3.4</span> Forcast of Manual Model</a></li>
  <li><a href="#benchmark-comparison" id="toc-benchmark-comparison" class="nav-link" data-scroll-target="#benchmark-comparison"><span class="header-section-number">3.5</span> Benchmark Comparison</a></li>
  </ul></li>
  <li><a href="#natural-gas-consumptionsarima" id="toc-natural-gas-consumptionsarima" class="nav-link" data-scroll-target="#natural-gas-consumptionsarima"><span class="header-section-number">4</span> Natural Gas Consumption(SARIMA)</a>
  <ul class="collapse">
  <li><a href="#acf-pacf" id="toc-acf-pacf" class="nav-link" data-scroll-target="#acf-pacf"><span class="header-section-number">4.1</span> ACF &amp; PACF</a>
  <ul class="collapse">
  <li><a href="#equation-model-diagnotic-2" id="toc-equation-model-diagnotic-2" class="nav-link" data-scroll-target="#equation-model-diagnotic-2"><span class="header-section-number">4.1.1</span> Equation &amp; Model Diagnotic</a></li>
  </ul></li>
  <li><a href="#auto.arima-2" id="toc-auto.arima-2" class="nav-link" data-scroll-target="#auto.arima-2"><span class="header-section-number">4.2</span> auto.arima</a></li>
  <li><a href="#forecast-of-manual-model" id="toc-forecast-of-manual-model" class="nav-link" data-scroll-target="#forecast-of-manual-model"><span class="header-section-number">4.3</span> Forecast of Manual Model</a></li>
  <li><a href="#benchmark-comparison-1" id="toc-benchmark-comparison-1" class="nav-link" data-scroll-target="#benchmark-comparison-1"><span class="header-section-number">4.4</span> Benchmark Comparison</a></li>
  <li><a href="#seasonal-cross-validation" id="toc-seasonal-cross-validation" class="nav-link" data-scroll-target="#seasonal-cross-validation"><span class="header-section-number">4.5</span> Seasonal Cross Validation</a></li>
  </ul></li>
  <li><a href="#natural-gas-storage-sarima" id="toc-natural-gas-storage-sarima" class="nav-link" data-scroll-target="#natural-gas-storage-sarima"><span class="header-section-number">5</span> Natural Gas Storage (SARIMA)</a>
  <ul class="collapse">
  <li><a href="#acf-pacf-1" id="toc-acf-pacf-1" class="nav-link" data-scroll-target="#acf-pacf-1"><span class="header-section-number">5.1</span> ACF &amp; PACF</a></li>
  <li><a href="#model-select" id="toc-model-select" class="nav-link" data-scroll-target="#model-select"><span class="header-section-number">5.2</span> Model Select</a></li>
  <li><a href="#equation-model-diagnotic-3" id="toc-equation-model-diagnotic-3" class="nav-link" data-scroll-target="#equation-model-diagnotic-3"><span class="header-section-number">5.3</span> Equation &amp; Model Diagnotic</a></li>
  <li><a href="#auto.arima-3" id="toc-auto.arima-3" class="nav-link" data-scroll-target="#auto.arima-3"><span class="header-section-number">5.4</span> auto.arima</a></li>
  <li><a href="#forecast-of-manual-model-1" id="toc-forecast-of-manual-model-1" class="nav-link" data-scroll-target="#forecast-of-manual-model-1"><span class="header-section-number">5.5</span> Forecast of Manual Model</a></li>
  <li><a href="#benchmark-comparison-2" id="toc-benchmark-comparison-2" class="nav-link" data-scroll-target="#benchmark-comparison-2"><span class="header-section-number">5.6</span> Benchmark Comparison</a></li>
  <li><a href="#seasonal-cross-validation-1" id="toc-seasonal-cross-validation-1" class="nav-link" data-scroll-target="#seasonal-cross-validation-1"><span class="header-section-number">5.7</span> Seasonal Cross Validation</a></li>
  </ul></li>
  <li><a href="#wti-oil-pricearima" id="toc-wti-oil-pricearima" class="nav-link" data-scroll-target="#wti-oil-pricearima"><span class="header-section-number">6</span> WTI Oil Price(ARIMA)</a>
  <ul class="collapse">
  <li><a href="#acf-pacf-2" id="toc-acf-pacf-2" class="nav-link" data-scroll-target="#acf-pacf-2"><span class="header-section-number">6.1</span> ACF &amp; PACF</a></li>
  <li><a href="#model-select-1" id="toc-model-select-1" class="nav-link" data-scroll-target="#model-select-1"><span class="header-section-number">6.2</span> Model Select</a></li>
  <li><a href="#equation-model-diagnotic-4" id="toc-equation-model-diagnotic-4" class="nav-link" data-scroll-target="#equation-model-diagnotic-4"><span class="header-section-number">6.3</span> Equation &amp; Model Diagnotic</a>
  <ul class="collapse">
  <li><a href="#equation-1" id="toc-equation-1" class="nav-link" data-scroll-target="#equation-1"><span class="header-section-number">6.3.1</span> Equation</a></li>
  </ul></li>
  <li><a href="#auto.arima-4" id="toc-auto.arima-4" class="nav-link" data-scroll-target="#auto.arima-4"><span class="header-section-number">6.4</span> auto.arima</a></li>
  <li><a href="#forecast-of-manual-model-2" id="toc-forecast-of-manual-model-2" class="nav-link" data-scroll-target="#forecast-of-manual-model-2"><span class="header-section-number">6.5</span> Forecast of Manual Model</a></li>
  <li><a href="#benchmark-comparison-3" id="toc-benchmark-comparison-3" class="nav-link" data-scroll-target="#benchmark-comparison-3"><span class="header-section-number">6.6</span> Benchmark Comparison</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Univariate TS Models(ARIMA/SARIMA)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ke Tian </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TTR)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this page, we will do ARIMA and SARIMA based on the previous page EDA of natural gas production and prices.</p>
</section>
<section id="natural-gas-productionarima" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Natural Gas Production(ARIMA)</h1>
<p>From the previous <a href="https://ketian.georgetown.domains/5600webpage/_site/exploratorydataanalysis.html">Exploratory Data Analysis</a>, we get the following information :</p>
<p>1. Before differencing, there is significant autocorrelation in the time series, the ACF is significant at lag 1 and then decreases gradually, and the PACF decays rapidly at lag 1, indicating that the data are non-stationary.</p>
<p>2. After the first order differencing, the data are relatively stable, but the Augmented Dickey-Fuller Test confirms that the data are still non-stationary. So we will perform a second order difference to try to make the data stationary.</p>
<p>3. The p value of Augmented Dickey-Fuller Test of Second difference is smaller than 0.5, which means the data is stationary.</p>
<section id="acf-and-pacf" class="level2 tabset" data-number="2.1">
<h2 class="tabset anchored" data-number="2.1" data-anchor-id="acf-and-pacf"><span class="header-section-number">2.1</span> ACF and PACF</h2>
<section id="second-difference-acf-and-pacf" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="second-difference-acf-and-pacf"><span class="header-section-number">2.1.1</span> Second difference ACF and PACF</h3>
<p>based on the plot:</p>
<ol type="1">
<li>The ACF has two significant peaks, so q = 2</li>
<li>The PACF has one significant peak, so p = 1</li>
<li>we do diffenece twice, so d = 2</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(price_ts_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF of Differenced Natural Gas Prices"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># PACF</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(price_ts_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF of Differenced Natural Gas Prices"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="manual-arima" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="manual-arima"><span class="header-section-number">2.1.2</span> Manual ARIMA</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>d_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>q_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>model_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">character</span>(),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">numeric</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> p_values) {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (d <span class="cf">in</span> d_values) {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (q <span class="cf">in</span> q_values) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      model_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"ARIMA("</span>, p, <span class="st">","</span>, d, <span class="st">","</span>, q, <span class="st">")"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_us_gas, <span class="at">order =</span> <span class="fu">c</span>(p, d, q))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(model)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      model_results <span class="ot">&lt;-</span> model_results <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_row</span>(<span class="at">Model =</span> model_name, <span class="at">AIC =</span> model<span class="sc">$</span>aic, <span class="at">BIC =</span> model<span class="sc">$</span>bic, <span class="at">RMSE =</span> rmse)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  Model          AIC   BIC  RMSE
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 ARIMA(0,2,0)  739.  741.  285.
2 ARIMA(0,2,1)  721.  725.  232.
3 ARIMA(0,2,2)  721.  726.  226.
4 ARIMA(1,2,0)  738.  742.  275.
5 ARIMA(1,2,1)  722.  728.  230.
6 ARIMA(1,2,2)  720.  728.  220.
7 ARIMA(2,2,0)  722.  728.  230.
8 ARIMA(2,2,1)  717.  724.  213.
9 ARIMA(2,2,2)  718.  728.  213.</code></pre>
</div>
</div>
<p>Based on the result, ARIMA(2,2,1) is the best model, cause it has smaller AIC(716.5059) and BIC(724.3108), and the RMSE is smaller than other model.</p>
</section>
<section id="equation" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="equation"><span class="header-section-number">2.1.3</span> Equation</h3>
<p>Base on the model ARIMA(2,2,1), We write this equation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_us_gas, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_us_gas 
ARIMA(2,2,1) 

Coefficients:
         ar1      ar2      ma1
      0.0247  -0.4174  -0.6968
s.e.  0.1521   0.1367   0.1283

sigma^2 = 50011:  log likelihood = -354.25
AIC=716.51   AICc=717.36   BIC=724.31

Training set error measures:
                   ME    RMSE      MAE       MPE     MAPE      MASE      ACF1
Training set 27.35006 213.026 164.5701 0.4066396 2.951763 0.1488864 0.0100288</code></pre>
</div>
</div>
<p><span class="math display">\[
\Delta^2 y_t = 0.0247 \cdot \Delta^2 y_{t-1} - 0.4174 \cdot \Delta^2 y_{t-2} + \varepsilon_t - 0.6968 \cdot \varepsilon_{t-1}
\]</span></p>
</section>
<section id="model-diagnotic" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="model-diagnotic"><span class="header-section-number">2.1.4</span> Model Diagnotic</h3>
<p>Here we will do the model Diagnotic</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">residuals</span>(best_model)) <span class="sc">+</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Residuals of ARIMA(2,2,1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(best_model), <span class="at">main=</span><span class="st">"ACF of Residuals for ARIMA(2,2,1)"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(best_model))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(best_model), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(<span class="fu">residuals</span>(best_model), <span class="at">lag=</span><span class="dv">10</span>, <span class="at">type=</span><span class="st">"Ljung-Box"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  residuals(best_model)
X-squared = 3.3906, df = 10, p-value = 0.9707</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The residual plots show that the residuals fluctuate around the zero mean with no clear trend or pattern. It shows that the model fits the data better. The ACF plot shows that the autocorrelation of the residuals is low and all the lags are within the blue dashed line (95% confidence interval), indicating that the residuals are almost white noise.The Q-Q plot shows how well the distribution of the residuals fits the data relative to the normal distribution.The Box-Ljung test p-value is 0.9707, which is much larger than 0.05, which suggests that the original hypothesis cannot be rejected, i.e., the residuals are white noise.</p>
</section>
<section id="auto.arima" class="level3" data-number="2.1.5">
<h3 data-number="2.1.5" class="anchored" data-anchor-id="auto.arima"><span class="header-section-number">2.1.5</span> auto.arima</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>auto_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_us_gas)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(auto_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_us_gas 
ARIMA(2,2,1) 

Coefficients:
         ar1      ar2      ma1
      0.0247  -0.4174  -0.6968
s.e.  0.1521   0.1367   0.1283

sigma^2 = 50011:  log likelihood = -354.25
AIC=716.51   AICc=717.36   BIC=724.31</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>manual_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_us_gas, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Manual ARIMA(2,2,1)"</span>, <span class="fu">paste0</span>(<span class="st">"Auto "</span>, auto_model)),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(manual_model), <span class="fu">AIC</span>(auto_model)),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">c</span>(<span class="fu">BIC</span>(manual_model), <span class="fu">BIC</span>(auto_model)),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(manual_model)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(auto_model)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                Model      AIC      BIC    RMSE
1 Manual ARIMA(2,2,1) 716.5059 724.3108 213.026
2   Auto ARIMA(2,2,1) 716.5059 724.3108 213.026</code></pre>
</div>
</div>
<p>The best model from auto.arima is the same as the one we chose manually, and both AIC, BIC and RMSE is same. This suggests that the p,d,q choices we made based on ACF, PACF, and differential stability analysis are reasonable.</p>
</section>
<section id="forcast" class="level3" data-number="2.1.6">
<h3 data-number="2.1.6" class="anchored" data-anchor-id="forcast"><span class="header-section-number">2.1.6</span> Forcast</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ts_us_gas <span class="ot">&lt;-</span> <span class="fu">ts</span>(us_gas<span class="sc">$</span>Production, <span class="at">start =</span> <span class="fu">min</span>(us_gas<span class="sc">$</span>Year), <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>forecast_horizon <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_us_gas, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>arima_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(best_model, <span class="at">h =</span> forecast_horizon)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(arima_forecast) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast using ARIMA(2,2,1)"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Predicted Values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The forecast graph shows that natural gas production is expected to continue to rise over the next 10 years.</p>
<p>Confidence intervals provide a range of uncertainty in a forecast. The dark blue area: 80% confidence interval, indicates a higher probability that future forecasts will fall within this interval, and the light blue area: 95% confidence interval, indicates a higher probability that forecasts will fall within this interval, but the range is wider, reflecting greater uncertainty.</p>
</section>
<section id="compare-arima-model-with-benchmark-methods" class="level3" data-number="2.1.7">
<h3 data-number="2.1.7" class="anchored" data-anchor-id="compare-arima-model-with-benchmark-methods"><span class="header-section-number">2.1.7</span> Compare ARIMA model with Benchmark methods</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>forecast_horizon <span class="ot">&lt;-</span> <span class="dv">10</span>  </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_us_gas, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>))  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>arima_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(best_model, <span class="at">h =</span> forecast_horizon)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>mean_forecast_values <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">mean</span>(ts_us_gas), forecast_horizon)  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>moving_avg_forecast_values <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">mean</span>(<span class="fu">tail</span>(ts_us_gas, <span class="dv">5</span>)), forecast_horizon)  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>random_walk_forecast_values <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">tail</span>(ts_us_gas, <span class="dv">1</span>), forecast_horizon) </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>exp_smooth_model <span class="ot">&lt;-</span> <span class="fu">ets</span>(ts_us_gas)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>exp_smooth_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(exp_smooth_model, <span class="at">h =</span> forecast_horizon)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="fu">seq</span>(<span class="fu">end</span>(ts_us_gas)[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> forecast_horizon),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ARIMA =</span> arima_forecast<span class="sc">$</span>mean,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Forecast =</span> mean_forecast_values,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Moving_Avg =</span> moving_avg_forecast_values,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Random_Walk =</span> random_walk_forecast_values,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Exp_Smooth =</span> exp_smooth_forecast<span class="sc">$</span>mean</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>forecast_df_long <span class="ot">&lt;-</span> forecast_df <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Model"</span>, <span class="at">values_to =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(forecast_df_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Forecast, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of ARIMA and Benchmark Methods"</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Values"</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Model"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="natural-gas-price-arima" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Natural Gas Price (ARIMA)</h1>
<section id="acf-and-pacf-1" class="level2 tabset" data-number="3.1">
<h2 class="tabset anchored" data-number="3.1" data-anchor-id="acf-and-pacf-1"><span class="header-section-number">3.1</span> ACF and PACF</h2>
<p>From <a href="https://ketian.georgetown.domains/5600webpage/_site/exploratorydataanalysis.html">Exploratory Data Analysis</a>, we have did the ACF and PACF, and the Augmented Dickey-Fuller Test, the p-value is 0.1 which means the data is stationary, we don’t need to do differencing.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(price_ts_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  price_ts_diff
Dickey-Fuller = -5.4792, Lag order = 5, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>Here is the graph of ACF and PACF:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(price_ts_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF of Differenced Natural Gas Prices"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># PACF</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(price_ts_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF of Differenced Natural Gas Prices"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looking at the PACF, Lag 1 significantly exceeds the confidence interval, Lag 2 and subsequent lags decay rapidly and fall into the confidence interval, so I choose p=1, in the ACF, Lag 1 is significantly positively correlated and far exceeds the confidence interval, most of the lags from Lag 2~Lag 36 fluctuate less, and some of them are slightly beyond the confidence interval, but overall there is no consecutive significant lag or cyclical pattern, so q=1, and we have already done one difference before, so d=1. 1, before we have done a differencing, so d=1</p>
</section>
<section id="maunal-sarima" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="maunal-sarima"><span class="header-section-number">3.2</span> Maunal SARIMA</h2>
<section id="aic-bic" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="aic-bic"><span class="header-section-number">3.2.1</span> AIC &amp; BIC</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model_010 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_natgas_monthly, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_011 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_natgas_monthly, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>model_110 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_natgas_monthly, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>model_111 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_natgas_monthly, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>aic_compare <span class="ot">&lt;-</span> <span class="fu">AIC</span>(model_010, model_011, model_110, model_111)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>bic_compare <span class="ot">&lt;-</span> <span class="fu">BIC</span>(model_010, model_011, model_110, model_111)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(aic_compare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          df      AIC
model_010  1 242.2507
model_011  2 235.6020
model_110  2 237.9544
model_111  3 235.3642</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bic_compare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          df      BIC
model_010  1 245.4492
model_011  2 241.9990
model_110  2 244.3514
model_111  3 244.9597</code></pre>
</div>
</div>
<p>Fit all model, we find that ARIMA(1,1,1) is the best model, cause it has lower AIC, it indicates the best fit</p>
</section>
<section id="equation-model-diagnotic" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="equation-model-diagnotic"><span class="header-section-number">3.2.2</span> Equation &amp; Model Diagnotic</h3>
<p><span class="math display">\[
\Delta y_t = -0.2982 \cdot \Delta y_{t-1} + \varepsilon_t + 0.5466 \cdot \varepsilon_{t-1}
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_111)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_natgas_monthly 
ARIMA(1,1,1) 

Coefficients:
          ar1     ma1
      -0.3057  0.5437
s.e.   0.1919  0.1649

sigma^2 = 0.2101:  log likelihood = -114.68
AIC=235.36   AICc=235.5   BIC=244.96

Training set error measures:
                       ME      RMSE       MAE        MPE     MAPE      MASE
Training set -0.008695573 0.4546056 0.3189351 -0.7856635 9.269679 0.2686084
                   ACF1
Training set -0.0122801</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(model_111)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,1,1)
Q* = 36.639, df = 22, p-value = 0.0259

Model df: 2.   Total lags used: 24</code></pre>
</div>
</div>
<p>The time series plot of the residuals shows that the residuals fluctuate around zero, with no obvious trend or structural change, and the variance is relatively stable; most of the lagged orders in the ACF plot of the residuals fall within the confidence intervals, and no systematic autocorrelation is observed. The histogram of residuals is close to normal distribution, which supports the subsequent confidence prediction. However, the p-value of Ljung-Box test is 0.01752, which is lower than the significance level of 0.05, indicating that the residuals may still contain a small amount of unmodeled structure.</p>
</section>
</section>
<section id="auto.arima-1" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="auto.arima-1"><span class="header-section-number">3.3</span> auto.arima</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>auto_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_natgas_monthly, <span class="at">seasonal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(auto_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_natgas_monthly 
ARIMA(1,0,1) with non-zero mean 

Coefficients:
         ar1     ma1    mean
      0.8865  0.3137  3.4924
s.e.  0.0371  0.0837  0.3687

sigma^2 = 0.2026:  log likelihood = -112.5
AIC=233   AICc=233.22   BIC=245.81

Training set error measures:
                      ME      RMSE       MAE       MPE     MAPE      MASE
Training set -0.01314029 0.4463363 0.3142812 -1.804642 9.225536 0.2646889
                   ACF1
Training set -0.0362512</code></pre>
</div>
</div>
<p>The optimal model obtained using the auto.arima() automatic model selection function is ARIMA(1,0,1), which is different from the manually selected ARIMA(1,1,1). The main reason for this is that the automatic model judged that the original series had satisfied the smoothness requirement and therefore was not differenced (d = 0). The automatic selection model has a lower AIC value</p>
<section id="equation-model-diagnotic-1" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="equation-model-diagnotic-1"><span class="header-section-number">3.3.1</span> Equation &amp; Model Diagnotic</h3>
<p><span class="math display">\[
y_t = \mu + 0.8850 \cdot y_{t-1} + \varepsilon_t + 0.3279 \cdot \varepsilon_{t-1}
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(auto_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,0,1) with non-zero mean
Q* = 40.21, df = 22, p-value = 0.01022

Model df: 2.   Total lags used: 24</code></pre>
</div>
</div>
<p>The residual diagnosis of the ARIMA(1,0,1) model selected by auto.arima() reveals that the residual time series are generally stable and volatile, and the distribution is close to normal; however, the autocorrelation of some of the lags in the ACF plots slightly exceeds the confidence intervals, and the Ljung-Box test result of p = 0.0068 rejects the original hypothesis that “the residuals are white noise”. Ljung-Box test p = 0.0068, rejecting the original hypothesis of “residuals are white noise”.</p>
</section>
</section>
<section id="forcast-of-manual-model" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="forcast-of-manual-model"><span class="header-section-number">3.4</span> Forcast of Manual Model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>forecast_111 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model_111, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecast_111) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Forecast from ARIMA(1,1,1)"</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Natural Gas Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ARIMA (1,1,1) forecasts of natural gas prices over the next 12 periods indicate a stable price trend, with the point forecasts changing little from recent observations. However, the forecast range widens significantly, reflecting a high degree of uncertainty and recent historical volatility. The model predicts that while average prices are not expected to change dramatically, there could still be large deviations in prices in the future, which could be caused by geopolitical events, supply shocks, or seasonal demand changes</p>
</section>
<section id="benchmark-comparison" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="benchmark-comparison"><span class="header-section-number">3.5</span> Benchmark Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(ts_natgas_monthly)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_natgas_monthly, <span class="at">end =</span> <span class="fu">c</span>(<span class="fu">time</span>(ts_natgas_monthly)[n <span class="sc">-</span> <span class="dv">12</span>]))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_natgas_monthly, <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">time</span>(ts_natgas_monthly)[n <span class="sc">-</span> <span class="dv">11</span>]))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>fit_arima <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>fcast_arima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_arima, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>fcast_mean <span class="ot">&lt;-</span> <span class="fu">meanf</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>fcast_naive <span class="ot">&lt;-</span> <span class="fu">naive</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>fcast_drift <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>fcast_snaive <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>acc_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ARIMA =</span> <span class="fu">accuracy</span>(fcast_arima, test)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)],</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean  =</span> <span class="fu">accuracy</span>(fcast_mean,  test)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)],</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naive =</span> <span class="fu">accuracy</span>(fcast_naive, test)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)],</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Drift =</span> <span class="fu">accuracy</span>(fcast_drift, test)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)],</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">SNaive =</span> <span class="fu">accuracy</span>(fcast_snaive, test)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)]</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(acc_all, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        RMSE   MAE   MAPE
ARIMA  0.832 0.688 20.494
Mean   0.718 0.579 22.303
Naive  0.932 0.765 22.319
Drift  1.059 0.870 25.271
SNaive 1.167 0.939 28.095</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_all <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">time</span>(test),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ARIMA =</span> fcast_arima<span class="sc">$</span>mean,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> fcast_mean<span class="sc">$</span>mean,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naive =</span> fcast_naive<span class="sc">$</span>mean,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">SNaive =</span> fcast_snaive<span class="sc">$</span>mean</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Model"</span>, <span class="at">values_to =</span> <span class="st">"Forecast"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>df_hist <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">time</span>(ts_natgas_monthly),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Price =</span> <span class="fu">as.numeric</span>(ts_natgas_monthly)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_hist, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Price), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_all, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Forecast, <span class="at">color =</span> Model), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast Comparison with Baseline Models"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Natural Gas Price"</span>) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"ARIMA"</span> <span class="ot">=</span> <span class="st">"brown"</span>, <span class="st">"Mean"</span> <span class="ot">=</span> <span class="st">"yellowgreen"</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Naive"</span> <span class="ot">=</span> <span class="st">"cyan"</span>, <span class="st">"SNaive"</span> <span class="ot">=</span> <span class="st">"mediumorchid"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="natural-gas-consumptionsarima" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Natural Gas Consumption(SARIMA)</h1>
<section id="acf-pacf" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="acf-pacf"><span class="header-section-number">4.1</span> ACF &amp; PACF</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_consumption <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Natural_Gas_Summary.csv"</span>,<span class="at">skip =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Month)) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year      =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">".* ([0-9]{4})$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, Month)),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month_Num =</span> <span class="fu">match</span>(<span class="fu">substr</span>(Month, <span class="dv">1</span>, <span class="dv">3</span>), month.abb)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year, Month_Num)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>df_cons <span class="ot">&lt;-</span> df_consumption <span class="sc">%&gt;%</span> </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Month, Year, Month_Num,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">U.S..Natural.Gas.Total.Consumption..MMcf..MMcf</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TotalConsumption =</span> <span class="st">`</span><span class="at">U.S..Natural.Gas.Total.Consumption..MMcf..MMcf</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">TotalConsumption =</span> <span class="fu">as.numeric</span>(TotalConsumption),          </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">sprintf</span>(<span class="st">"%d-%02d-01"</span>, Year, Month_Num))         </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>first_valid_index <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(df_cons<span class="sc">$</span>TotalConsumption))[<span class="dv">1</span>]</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> df_cons<span class="sc">$</span>Year[first_valid_index]</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>start_month <span class="ot">&lt;-</span> df_cons<span class="sc">$</span>Month_Num[first_valid_index]</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>ts_trimmed <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">na.omit</span>(df_cons<span class="sc">$</span>TotalConsumption),</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">c</span>(start_year, start_month),</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>ts_diff1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_trimmed, <span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(ts_diff1, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF of First Differenced Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(ts_diff1, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF of First Differenced Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ts_diff_seasonal <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_diff1, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(ts_diff_seasonal, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF of Seasonally First Differenced Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(ts_diff_seasonal, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF of Seasonally Differenced Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The original series is non-stationary, so first-order non-seasonal differencing is used (d = 1); the ACF after the first differencing is significant at lag 1 (q = 1), and the ACF is significant at lag 1 (p = 1). At the same time, the series showed strong annual cyclical fluctuations, so we performed a seasonal differencing (d = 1); the ACF after the seasonal differencing was significant at lag 12 (q = 1); and the PACF had no significant truncation feature at the seasonal lag, so the seasonal AR term was set to 0 (p = 0)</p>
<section id="equation-model-diagnotic-2" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="equation-model-diagnotic-2"><span class="header-section-number">4.1.1</span> Equation &amp; Model Diagnotic</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(ts_trimmed,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">p =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">P =</span> <span class="dv">0</span>, <span class="at">D =</span> <span class="dv">1</span>, <span class="at">Q =</span> <span class="dv">1</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">S =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value 11.990868 
iter   2 value 11.754827
iter   3 value 11.657875
iter   4 value 11.648092
iter   5 value 11.632667
iter   6 value 11.621476
iter   7 value 11.614114
iter   8 value 11.608385
iter   9 value 11.600413
iter  10 value 11.596024
iter  11 value 11.592405
iter  12 value 11.592125
iter  13 value 11.591115
iter  14 value 11.591114
iter  14 value 11.591114
final  value 11.591114 
converged
initial  value 11.596775 
iter   2 value 11.595523
iter   3 value 11.595109
iter   4 value 11.594832
iter   5 value 11.594798
iter   6 value 11.594792
iter   6 value 11.594792
iter   6 value 11.594792
final  value 11.594792 
converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
     Estimate     SE  t.value p.value
ar1    0.3296 0.0743   4.4332       0
ma1   -0.9019 0.0393 -22.9314       0
sma1  -0.8225 0.0375 -21.9371       0

sigma^2 estimated as 11142182227 on 270 degrees of freedom 
 
AIC = 26.05677  AICc = 26.05709  BIC = 26.10965 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The time-series plot of the standardized residuals shows that the standardized residuals fluctuate around 0, with no obvious trend or seasonal structure, the fluctuations are stable, and no extreme outliers are observed. This indicates that the model captures the dynamics of the original series well.The ACF plot shows that the autocorrelation coefficients of most of the lagged points in the ACF plot of the residuals fall within the 95% confidence intervals (between the blue dotted lines), which suggests that there is no significant autocorrelation in the residuals series. The Q-Q plots of the standardized residuals show that the points fall roughly around the diagonal line, indicating that the residuals are approximately normally distributed, and the p-value plots of the Ljung-Box test show that all p-values are above the significance level of 0.05, which means that the hypothesis of no autocorrelation in the residuals cannot be rejected.</p>
<p><span class="math display">\[
(1 - 0.3296 B)(1 - B)(1 - B^{12}) y_t = (1 - 0.9019 B)(1 - 0.8225 B^{12}) \varepsilon_t
\]</span></p>
</section>
</section>
<section id="auto.arima-2" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="auto.arima-2"><span class="header-section-number">4.2</span> auto.arima</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>auto_s_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_trimmed, <span class="at">seasonal =</span> <span class="cn">TRUE</span>, <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(auto_s_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_trimmed 
ARIMA(1,0,1)(2,1,1)[12] with drift 

Coefficients:
         ar1      ma1    sar1     sar2     sma1      drift
      0.8962  -0.5686  0.0005  -0.2273  -0.7219  3408.8871
s.e.  0.0557   0.1089  0.0761   0.0721   0.0615   558.5785

sigma^2 = 1.112e+10:  log likelihood = -3561.24
AIC=7136.48   AICc=7136.9   BIC=7161.77</code></pre>
</div>
</div>
<p>The automatically selected model is different from the manually selected model. auto.arima selects the ARIMA(1,0,1)(2,1,1)[12] model without non-seasonal differencing (d=0) but with the drift term added, while the manual model uses the SARIMA(1,1,1)(0,1,1)[12]</p>
</section>
<section id="forecast-of-manual-model" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="forecast-of-manual-model"><span class="header-section-number">4.3</span> Forecast of Manual Model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fit_final <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_trimmed,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">period =</span> <span class="dv">12</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_final, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecast_result) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast from SARIMA(1,1,1)(0,1,1)[12]"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Natural Gas Consumption (MMcf)"</span>, <span class="at">x =</span> <span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model provides credible short-term forecasts that better reflect the seasonal and trend characteristics of natural gas consumption. The forecast results show that natural gas consumption will remain cyclical and show a slight upward trend in the coming year. The model and its forecasts can provide data support for energy policy making, supply chain planning and risk management.</p>
</section>
<section id="benchmark-comparison-1" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="benchmark-comparison-1"><span class="header-section-number">4.4</span> Benchmark Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ts_end <span class="ot">&lt;-</span> <span class="fu">end</span>(ts_trimmed)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>n_ahead <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>test_start_year  <span class="ot">&lt;-</span> ts_end[<span class="dv">1</span>]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>test_start_month <span class="ot">&lt;-</span> ts_end[<span class="dv">2</span>] <span class="sc">-</span> n_ahead <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (test_start_month <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  test_start_year  <span class="ot">&lt;-</span> test_start_year <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  test_start_month <span class="ot">&lt;-</span> test_start_month <span class="sc">+</span> <span class="dv">12</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_trimmed, <span class="at">end =</span> <span class="fu">c</span>(test_start_year, test_start_month <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_trimmed, <span class="at">start =</span> <span class="fu">c</span>(test_start_year, test_start_month))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>sarima_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">period =</span> <span class="dv">12</span>))</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>sarima_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(sarima_model, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>mean_forecast   <span class="ot">&lt;-</span> <span class="fu">meanf</span>(train, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>naive_forecast  <span class="ot">&lt;-</span> <span class="fu">naive</span>(train, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>snaive_forecast <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>accuracy_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">SARIMA =</span> <span class="fu">accuracy</span>(sarima_forecast, test),</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">MEAN   =</span> <span class="fu">accuracy</span>(mean_forecast, test),</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">NAIVE  =</span> <span class="fu">accuracy</span>(naive_forecast, test),</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">SNAIVE =</span> <span class="fu">accuracy</span>(snaive_forecast, test)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(accuracy_results[, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>)], <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 RMSE       MAE  MAPE
Training set 102241.2  76582.73  3.43
Test set     115135.3  95697.83  3.37
Training set 482869.3 398384.26 19.09
Test set     698839.7 584676.03 19.90
Training set 293632.8 235913.29 10.72
Test set     487902.2 336463.08 10.89
Training set 145711.0 113395.62  5.13
Test set     146447.3  97023.33  3.20</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(test, <span class="at">series =</span> <span class="st">"Actual"</span>) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(sarima_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"SARIMA"</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mean_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Mean"</span>) <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(naive_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Naive"</span>) <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(snaive_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Seasonal Naive"</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast Comparison (Test Set)"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Natural Gas Consumption"</span>, <span class="at">x =</span> <span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-cross-validation" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="seasonal-cross-validation"><span class="header-section-number">4.5</span> Seasonal Cross Validation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sarima_errors <span class="ot">&lt;-</span> <span class="cf">function</span>(ts_data, h, order, seasonal_order) {</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_data,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">forecastfunction =</span> <span class="cf">function</span>(y, h) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>              fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(y, <span class="at">order =</span> order,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> seasonal_order, <span class="at">period =</span> s))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">h =</span> h)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(e)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">sarima_errors</span>(ts_trimmed, <span class="at">h =</span> <span class="dv">1</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">seasonal_order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>e12 <span class="ot">&lt;-</span> <span class="fu">sarima_errors</span>(ts_trimmed, <span class="at">h =</span> <span class="dv">12</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">seasonal_order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>rmse_1  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e1<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>rmse_12 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e12<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1-step RMSE:"</span>, <span class="fu">round</span>(rmse_1, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-step RMSE: 113597.3 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"12-step RMSE:"</span>, <span class="fu">round</span>(rmse_12, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>12-step RMSE: 146786.6 </code></pre>
</div>
</div>
</section>
</section>
<section id="natural-gas-storage-sarima" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Natural Gas Storage (SARIMA)</h1>
<section id="acf-pacf-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="acf-pacf-1"><span class="header-section-number">5.1</span> ACF &amp; PACF</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_storage <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Natural_Gas_Summary.csv"</span>, <span class="at">skip =</span> <span class="dv">6</span>)<span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Month)) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year      =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">".* ([0-9]{4})$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, Month)),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month_Num =</span> <span class="fu">match</span>(<span class="fu">substr</span>(Month, <span class="dv">1</span>, <span class="dv">3</span>), month.abb)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year, Month_Num)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>df_store <span class="ot">&lt;-</span> df_storage <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    Month,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    Year,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    Month_Num,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">U.S..Total.Natural.Gas.in.Underground.Storage..Base.Gas...MMcf..MMcf</span><span class="st">`</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TotalStorage =</span> <span class="st">`</span><span class="at">U.S..Total.Natural.Gas.in.Underground.Storage..Base.Gas...MMcf..MMcf</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">TotalStorage =</span> <span class="fu">as.numeric</span>(TotalStorage),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date         =</span> <span class="fu">as.Date</span>(<span class="fu">sprintf</span>(<span class="st">"%d-%02d-01"</span>, Year, Month_Num))</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>first_valid_index <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(df_store<span class="sc">$</span>TotalStorage))[<span class="dv">1</span>]</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>start_year  <span class="ot">&lt;-</span> df_store<span class="sc">$</span>Year[first_valid_index]</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>start_month <span class="ot">&lt;-</span> df_store<span class="sc">$</span>Month_Num[first_valid_index]</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>ts_storage <span class="ot">&lt;-</span> <span class="fu">ts</span>(</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>(df_store<span class="sc">$</span>TotalStorage),</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">start     =</span> <span class="fu">c</span>(start_year, start_month),</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency =</span> <span class="dv">12</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>ts_storage_diff1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_storage, <span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(ts_storage_diff1, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF of First Differenced Storage Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(ts_storage_diff1, <span class="at">lag.max =</span> <span class="dv">48</span>) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF of First Differenced Storage Series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(ts_storage_diff1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  ts_storage_diff1
Dickey-Fuller = -6.917, Lag order = 8, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>We changed the non-smooth data to smooth data in the EDA section and found that Natural gas storage has significant seasonality by observing the decomposition plots.</p>
<p>Looking at the plots of pacf and pacf, we find that ACF has significant peaks at lag1, lag2, and lag12, and PACF has significant peaks at lag1 and lag12. So p = 1,2 q = 1, P = 0,1, Q = 0,1. We only performed one differencing neither seasonal differencing, so d = 1, D = 0</p>
</section>
<section id="model-select" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="model-select"><span class="header-section-number">5.2</span> Model Select</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>pdq <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">p =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>PDQ <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">P =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">D =</span> <span class="dv">0</span>, <span class="at">Q =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p=</span><span class="cn">NA</span>, <span class="at">d=</span><span class="cn">NA</span>, <span class="at">q=</span><span class="cn">NA</span>, <span class="at">P=</span><span class="cn">NA</span>, <span class="at">D=</span><span class="cn">NA</span>, <span class="at">Q=</span><span class="cn">NA</span>, <span class="at">AIC=</span><span class="cn">NA</span>, <span class="at">BIC=</span><span class="cn">NA</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pdq)) {</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(PDQ)) {</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> pdq<span class="sc">$</span>p[i]; d <span class="ot">&lt;-</span> pdq<span class="sc">$</span>d[i]; q <span class="ot">&lt;-</span> pdq<span class="sc">$</span>q[i]</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    P <span class="ot">&lt;-</span> PDQ<span class="sc">$</span>P[j]; D <span class="ot">&lt;-</span> PDQ<span class="sc">$</span>D[j]; Q <span class="ot">&lt;-</span> PDQ<span class="sc">$</span>Q[j]</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>({</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_storage,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(p,d,q),</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(P,D,Q), <span class="at">period =</span> s),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">data.frame</span>(<span class="at">p=</span>p, <span class="at">d=</span>d, <span class="at">q=</span>q, <span class="at">P=</span>P, <span class="at">D=</span>D, <span class="at">Q=</span>Q,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">AIC=</span><span class="fu">AIC</span>(fit), <span class="at">BIC=</span><span class="fu">BIC</span>(fit)))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(results)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>results_best <span class="ot">&lt;-</span> results[<span class="fu">order</span>(results<span class="sc">$</span>AIC), ]</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results_best, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC
23 2 1 1 1 0 0 13250.43 13272.35
25 2 1 1 1 0 1 13252.26 13278.56
24 2 1 1 0 0 1 13255.27 13277.19
19 1 1 1 1 0 0 13268.77 13286.30
11 2 1 0 1 0 0 13268.79 13286.32</code></pre>
</div>
</div>
<p>Based on the results of AIC and BIC we finally choose SARIMA (2, 1, 1) (1, 0, 0) [12] as our best model because this model has minimum AIC, BIC</p>
</section>
<section id="equation-model-diagnotic-3" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="equation-model-diagnotic-3"><span class="header-section-number">5.3</span> Equation &amp; Model Diagnotic</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>storage_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_storage,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">period =</span> <span class="dv">12</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(storage_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_storage 
ARIMA(2,1,1)(1,0,0)[12] 

Coefficients:
         ar1     ar2      ma1    sar1
      0.6077  0.3817  -0.9444  0.3054
s.e.  0.0447  0.0420   0.0241  0.0460

sigma^2 = 303330993:  log likelihood = -6620.22
AIC=13250.43   AICc=13250.54   BIC=13272.35

Training set error measures:
                    ME     RMSE      MAE          MPE      MAPE      MASE
Training set -83.06754 17342.82 9045.794 -0.002550476 0.2307734 0.2074543
                   ACF1
Training set 0.03360638</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(storage_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,1,1)(1,0,0)[12]
Q* = 16.495, df = 20, p-value = 0.6855

Model df: 4.   Total lags used: 24</code></pre>
</div>
</div>
<p>According to the results of the model diagnostics the residual plots showed random fluctuations and no structural patterns were seen; all lags in the ACF plots were within the confidence intervals; the residuals were approximately normally distributed; and the original hypothesis that the residuals were white noise was not rejected by the p-value of the Ljung-Box test = 0.6855.</p>
<p>Based on the coefficients in the summary, we can get the best model SARIMA (2, 1, 1) (1, 0, 0) [12] for the equation</p>
<p><span class="math display">\[
y_t - y_{t-1} = 0.6077(y_{t-1} - y_{t-2}) + 0.3817(y_{t-2} - y_{t-3}) + 0.3054(y_{t-12} - y_{t-13}) + \varepsilon_t - 0.9444\varepsilon_{t-1}
\]</span></p>
</section>
<section id="auto.arima-3" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="auto.arima-3"><span class="header-section-number">5.4</span> auto.arima</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>auto_storage <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_storage, <span class="at">seasonal =</span> <span class="cn">TRUE</span>, <span class="at">stepwise =</span> <span class="cn">FALSE</span>,  <span class="at">approximation =</span> <span class="cn">FALSE</span>)   </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(auto_storage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_storage 
ARIMA(1,2,1)(1,0,0)[12] 

Coefficients:
          ar1      ma1    sar1
      -0.3832  -0.9520  0.3047
s.e.   0.0424   0.0177  0.0461

sigma^2 = 303141083:  log likelihood = -6610.07
AIC=13228.14   AICc=13228.21   BIC=13245.67

Training set error measures:
                   ME     RMSE      MAE         MPE      MAPE      MASE
Training set -1280.99 17337.39 9142.217 -0.03897126 0.2331809 0.2096656
                   ACF1
Training set 0.09840195</code></pre>
</div>
</div>
<p>The best model selected using auto.arima is SARIMA(1,2,1)(1,0,0) [12], which is different from the best model we selected manually, the reason for this is because auto.arima thinks that it should be differenced twice, whereas the data showed a smooth trend after we performed one differencing and did not need to perform a second differencing.</p>
</section>
<section id="forecast-of-manual-model-1" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="forecast-of-manual-model-1"><span class="header-section-number">5.5</span> Forecast of Manual Model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>storage_final_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_storage,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">period =</span> <span class="dv">12</span>),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>storage_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(storage_final_model, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(storage_forecast) <span class="sc">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast from SARIMA(2,1,1)(1,0,0)[12]"</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Natural Gas Storage)"</span>, <span class="at">x =</span> <span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The SARIMA (2,1,1)(1,0,0)[12] model provides stable and well-bounded predictions of natural gas reserves for the next 12 periods. The point forecasts continue the upward trend seen in the historical data, and the forecast intervals remain narrow, indicating a high level of confidence in the model. The absence of large seasonal fluctuations in the forecasts suggests that the seasonal component is effectively modeled without the need for seasonal differencing. Given the strong residual diagnostic ability and relatively low prediction error, the model provides a reliable basis for short-term natural gas reserve forecasting.</p>
</section>
<section id="benchmark-comparison-2" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="benchmark-comparison-2"><span class="header-section-number">5.6</span> Benchmark Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_storage, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">4</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_storage, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">5</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>naive_fit <span class="ot">&lt;-</span> <span class="fu">naive</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>snaive_fit <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>mean_fit  <span class="ot">&lt;-</span> <span class="fu">meanf</span>(train, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>drift_fit <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train, <span class="at">drift =</span> <span class="cn">TRUE</span>, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>sarima_fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">period =</span> <span class="dv">12</span>))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>sarima_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(sarima_fit, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="fu">time</span>(test),</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> <span class="fu">as.numeric</span>(test),</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">SARIMA =</span> <span class="fu">as.numeric</span>(sarima_forecast<span class="sc">$</span>mean),</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naive =</span> <span class="fu">as.numeric</span>(naive_fit<span class="sc">$</span>mean),</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">SeasonalNaive =</span> <span class="fu">as.numeric</span>(snaive_fit<span class="sc">$</span>mean),</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">as.numeric</span>(mean_fit<span class="sc">$</span>mean)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>comparison_long <span class="ot">&lt;-</span> comparison_df <span class="sc">%&gt;%</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Time, <span class="at">names_to =</span> <span class="st">"Model"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>comparison_long <span class="ot">&lt;-</span> comparison_df <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Time, <span class="at">names_to =</span> <span class="st">"Model"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Value, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast Comparison (Test Set)"</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Natural Gas Consumption"</span>, <span class="at">x =</span> <span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The figure compares actual natural gas consumption with forecasts from several models over the test period (2022.5 – 2023.4). Among all models, SARIMA exhibits the closest fit to the actual data, capturing the upward trend with minimal deviation.</p>
<p>Naive and Seasonal Naive models perform moderately well but underestimate the actual values in most months, and show less responsiveness to trend shifts.</p>
<p>The Mean forecast performs poorly, providing a static prediction that fails to capture any variation in the test</p>
</section>
<section id="seasonal-cross-validation-1" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="seasonal-cross-validation-1"><span class="header-section-number">5.7</span> Seasonal Cross Validation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 step</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>errors_1 <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_storage,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">forecastfunction =</span> <span class="cf">function</span>(y, h) {</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                   fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(y, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">period =</span> s))</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 steps</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>errors_12 <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_storage,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">forecastfunction =</span> <span class="cf">function</span>(y, h) {</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>                    fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(y, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">period =</span> s))</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                  },</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">h =</span> s)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>rmse_1  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(errors_1<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>rmse_12 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(errors_12<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1-step RMSE:"</span>, <span class="fu">round</span>(rmse_1, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-step RMSE: 16806.19 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"12-step RMSE:"</span>, <span class="fu">round</span>(rmse_12, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>12-step RMSE: 33876.29 </code></pre>
</div>
</div>
</section>
</section>
<section id="wti-oil-pricearima" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> WTI Oil Price(ARIMA)</h1>
<section id="acf-pacf-2" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="acf-pacf-2"><span class="header-section-number">6.1</span> ACF &amp; PACF</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>oil_prices <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"CL=F"</span>, <span class="at">from =</span> <span class="st">"2010-01-01"</span>, <span class="at">to =</span> <span class="fu">Sys.Date</span>())</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>clean_oil <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(oil_prices)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>monthly_oil <span class="ot">&lt;-</span> clean_oil <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">price =</span> <span class="fu">mean</span>(adjusted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>ts_oil <span class="ot">&lt;-</span> <span class="fu">ts</span>(monthly_oil<span class="sc">$</span>price, <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">year</span>(<span class="fu">min</span>(monthly_oil<span class="sc">$</span>month)), </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">month</span>(<span class="fu">min</span>(monthly_oil<span class="sc">$</span>month))),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>ts_oil_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_oil)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>ts_oil_diff <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(ts_oil_diff)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(ts_oil_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"ACF of Differenced WTI Oil Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(ts_oil_diff, <span class="at">lag.max =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"PACF of Differenced WTI Oil Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Differential ACF and PACF plots show that ACF has a significant peak at lag1, so q=1, 2 PACF has significant peak at lag1 so p=1, 2 d = 1, because we performed the differencing process once</p>
</section>
<section id="model-select-1" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="model-select-1"><span class="header-section-number">6.2</span> Model Select</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">character</span>(),</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">numeric</span>(),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">numeric</span>()</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (order <span class="cf">in</span> orders) {</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> order[<span class="dv">1</span>]</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> order[<span class="dv">2</span>]</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> order[<span class="dv">3</span>]</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  model_fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_oil, <span class="at">order =</span> <span class="fu">c</span>(p, d, q))</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  model_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"ARIMA("</span>, p, <span class="st">","</span>, d, <span class="st">","</span>, q, <span class="st">")"</span>)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">add_row</span>(results,</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Model =</span> model_name,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AIC =</span> <span class="fu">AIC</span>(model_fit),</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BIC =</span> <span class="fu">BIC</span>(model_fit))</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>results_sorted <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AIC)</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_sorted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Model          AIC   BIC
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
1 ARIMA(1,1,1) 1155. 1165.
2 ARIMA(2,1,1) 1155. 1168.
3 ARIMA(1,1,2) 1156. 1169.
4 ARIMA(2,1,2) 1157. 1173.</code></pre>
</div>
</div>
<p>Based on the results of AIC comparison of all models, ARIMA (1, 1, 1) has the lowest AIC and BIC, so we choose ARIMA (1, 1, 1) as the best model</p>
</section>
<section id="equation-model-diagnotic-4" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="equation-model-diagnotic-4"><span class="header-section-number">6.3</span> Equation &amp; Model Diagnotic</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>oil_best_model <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts_oil, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oil_best_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_oil 
ARIMA(1,1,1) 

Coefficients:
          ar1     ma1
      -0.0719  0.3622
s.e.   0.2333  0.2173

sigma^2 = 30.52:  log likelihood = -574.6
AIC=1155.21   AICc=1155.34   BIC=1164.85

Training set error measures:
                      ME     RMSE      MAE        MPE     MAPE      MASE
Training set -0.08483503 5.479128 4.300869 -0.4904109 6.772687 0.2621331
                     ACF1
Training set 0.0004648666</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(oil_best_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,1,1)
Q* = 20.142, df = 22, p-value = 0.5742

Model df: 2.   Total lags used: 24</code></pre>
</div>
</div>
<section id="equation-1" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="equation-1"><span class="header-section-number">6.3.1</span> Equation</h3>
<p><span class="math display">\[
\Delta y_t = -0.0747 \cdot \Delta y_{t-1} + \varepsilon_t + 0.3628 \cdot \varepsilon_{t-1}
\]</span></p>
<p>The residual diagnostics for the ARIMA (1,1,1) model indicate that the residuals approximate white noise. The time plots show no clear pattern or trend, and the ACF plots indicate that the residuals are uncorrelated. The histogram of the residuals is very close to a normal distribution. In addition, the Ljung-Box test yielded a p-value of 0.5471 (&gt; 0.05), confirming that the residuals were uncorrelated and that the model was adequately fitted to the data.</p>
</section>
</section>
<section id="auto.arima-4" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="auto.arima-4"><span class="header-section-number">6.4</span> auto.arima</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>oil_auto_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_oil, <span class="at">seasonal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oil_auto_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_oil 
ARIMA(0,1,1) 

Coefficients:
         ma1
      0.2993
s.e.  0.0714

sigma^2 = 30.37:  log likelihood = -574.66
AIC=1153.32   AICc=1153.39   BIC=1159.75

Training set error measures:
                      ME     RMSE      MAE        MPE     MAPE      MASE
Training set -0.08356688 5.480783 4.298566 -0.4727968 6.764429 0.2619928
                    ACF1
Training set -0.00714962</code></pre>
</div>
</div>
<p>The manually selected ARIMA(1,1,1) model and the automatically selected ARIMA(0,1,1) model differ in structure. While both include a moving average (MA(1)) term, the automatic model omits the autoregressive (AR) term. The lower AIC (1147.67 vs.&nbsp;1150) justifies this simplification, suggesting a better trade-off between model fit and complexity.</p>
</section>
<section id="forecast-of-manual-model-2" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="forecast-of-manual-model-2"><span class="header-section-number">6.5</span> Forecast of Manual Model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>forecast_oil <span class="ot">&lt;-</span> <span class="fu">forecast</span>(oil_best_model, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecast_oil) <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Forecast from ARIMA(1,1,1)"</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Oil Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The forecast plot based on the ARIMA(1,1,1) model shows that the WTI crude oil price is expected to remain relatively stable over the next 12 months. The central forecast exhibits a modest upward trend, while the 80% and 95% confidence intervals widen over time, reflecting increasing uncertainty in longer-term projections. The model does not anticipate extreme volatility, indicating a return to more typical price behavior after recent fluctuations. Given that ARIMA models are linear and assume constant variance, any future shocks or structural breaks</p>
</section>
<section id="benchmark-comparison-3" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="benchmark-comparison-3"><span class="header-section-number">6.6</span> Benchmark Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_oil, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2024</span>, <span class="dv">4</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_oil, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2024</span>, <span class="dv">5</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2025</span>, <span class="dv">4</span>))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">length</span>(test)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>naive_fit  <span class="ot">&lt;-</span> <span class="fu">naive</span>(train, <span class="at">h =</span> h)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>snaive_fit <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train, <span class="at">h =</span> h)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>mean_fit   <span class="ot">&lt;-</span> <span class="fu">meanf</span>(train, <span class="at">h =</span> h)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>drift_fit  <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train, <span class="at">drift =</span> <span class="cn">TRUE</span>, <span class="at">h =</span> h)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>arima_fit  <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>arima_fc   <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_fit, <span class="at">h =</span> h)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time          =</span> <span class="fu">time</span>(test),</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual        =</span> <span class="fu">as.numeric</span>(test),</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Naive         =</span> <span class="fu">as.numeric</span>(naive_fit<span class="sc">$</span>mean),</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">SeasonalNaive =</span> <span class="fu">as.numeric</span>(snaive_fit<span class="sc">$</span>mean),</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean          =</span> <span class="fu">as.numeric</span>(mean_fit<span class="sc">$</span>mean),</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Drift         =</span> <span class="fu">as.numeric</span>(drift_fit<span class="sc">$</span>mean),</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ARIMA         =</span> <span class="fu">as.numeric</span>(arima_fc<span class="sc">$</span>mean)</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>pred_long <span class="ot">&lt;-</span> pred_df <span class="sc">%&gt;%</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Time, <span class="at">names_to =</span> <span class="st">"Model"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Value, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast Comparison"</span>,</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Oil Price"</span>) <span class="sc">+</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="utsm_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Visual comparison of forecast values against actual WTI oil prices reveals that the ARIMA(1,1,1) model clearly outperforms all benchmark methods. It is the only model capable of closely following the downward trend and local fluctuations observed in the actual data. In contrast, the Naive and Mean models produce constant or flat forecasts, while the Drift model fails to capture the declining trend. The Seasonal Naive model shows erratic swings that do not reflect the actual behavior of the series, confirming the lack of strong seasonality. These results highlight the effectiveness of ARIMA in capturing the underlying dynamics of oil prices.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>